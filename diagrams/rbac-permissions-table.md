# RBAC权限矩阵表格

## 权限级别说明
- ✅ **允许** - 完全访问权限
- ❌ **拒绝** - 无访问权限  
- 🟡 **条件允许** - 有限制的访问权限

## 详细权限矩阵

| 角色/资源 | 项目创建 | 项目查看 | 项目编辑 | 项目删除 | 客户管理 | 报价修改 | 文件上传 | 报表导出 |
|-----------|----------|----------|----------|----------|----------|----------|----------|----------|
| **销售** | ✅ | ✅ (自己的) | ✅ | ❌ | ✅ | ✅ | 🟡 (限制类型) | ❌ |
| **销售主管** | ✅ | ✅ (团队的) | ✅ | 🟡 (需审批) | ✅ | ✅ | ✅ | ✅ |
| **设计师** | ❌ | ✅ (相关的) | 🟡 (仅方案) | ❌ | 🟡 (只读) | ❌ | ✅ | ❌ |
| **财务** | ❌ | ✅ (相关的) | 🟡 (仅价格) | ❌ | 🟡 (只读) | 🟡 (审核) | ❌ | ✅ |
| **系统管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

## 角色继承关系

```
普通用户
├── 销售
│   └── 销售主管 (继承销售权限 + 管理权限)
├── 设计师
├── 财务
└── 系统管理员
```

## 权限详细说明

### 销售角色
- **项目管理**: 可创建、查看自己的项目，编辑项目信息
- **客户管理**: 完整的客户信息管理权限
- **报价权限**: 可修改项目报价
- **文件限制**: 只能上传特定类型文件（如客户资料、初步方案）
- **报表限制**: 无法导出敏感的业务报表

### 销售主管角色
- **继承权限**: 拥有销售的所有权限
- **团队管理**: 可查看团队所有项目
- **审批权限**: 可审批项目删除请求
- **完整文件权限**: 可上传所有类型文件
- **报表权限**: 可导出团队业绩报表

### 设计师角色
- **项目参与**: 只能查看分配给自己的相关项目
- **方案编辑**: 只能编辑项目的方案设计部分
- **客户信息**: 只读访问相关客户信息
- **文件管理**: 可上传设计文件、图纸等
- **无财务权限**: 无法查看价格、报价等敏感信息

### 财务角色
- **项目查看**: 可查看涉及财务的相关项目
- **价格编辑**: 只能编辑项目的价格、成本信息
- **客户信息**: 只读访问客户基本信息
- **报价审核**: 可审核但不能直接修改报价
- **报表权限**: 可导出财务相关报表

### 系统管理员角色
- **完全权限**: 对所有资源拥有完整的CRUD权限
- **系统维护**: 负责用户管理、权限分配、系统配置
- **数据管理**: 可进行数据备份、恢复等操作

## 特殊权限规则

### 职责分离 (SoD)
- 提交报价的用户不能是最终审批的用户
- 财务审核人员不能是项目的直接负责人
- 系统管理员不参与具体业务决策

### 数据访问范围
- **自己的**: 只能访问自己创建或负责的记录
- **团队的**: 可访问所在团队/部门的记录
- **相关的**: 只能访问与自己工作相关的记录
- **全部**: 可访问系统中的所有记录

### 条件权限示例
- **销售文件上传限制**: 只能上传 .pdf, .doc, .jpg 等常见格式
- **设计师方案编辑**: 只能修改设计方案字段，不能修改价格
- **财务价格编辑**: 只能修改成本、利润率，不能修改设计内容
- **销售主管删除审批**: 删除操作需要提交审批流程

## 权限验证流程

1. **用户登录** → 获取用户角色信息
2. **请求资源** → 检查角色权限矩阵
3. **条件判断** → 验证特殊条件（如数据范围、业务规则）
4. **权限决策** → 允许/拒绝访问
5. **操作日志** → 记录所有权限相关操作

## 权限管理最佳实践

- **最小权限原则**: 用户只获得完成工作所需的最小权限
- **定期审查**: 定期检查和更新用户权限
- **权限分离**: 关键操作需要多人协作完成
- **审计跟踪**: 所有权限变更和敏感操作都有完整日志
